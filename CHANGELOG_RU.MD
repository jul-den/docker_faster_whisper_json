# Changelog

*English version available in [`CHANGELOG.md`](CHANGELOG.md).*

Все значимые изменения проекта документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.1.0/).

## [1.1.0] - 2026-02-24

[1.1.0]: https://github.com/jul-den/docker_faster_whisper_json/releases/tag/v1.1.0

### Добавлено
- Поддержка универсального формата `input` в шаге `concat`:
  - Можно задавать строку (одна маска) или список строк (маски и/или точные имена файлов).
  - Автоматическое раскрытие glob-символов (`*`, `?`, `[]`).
- Новый тип `audio` для шага `concat`:
  - Склейка аудиофайлов с автоматическим приведением к единым параметрам.
  - Параметры `ar` (частота дискретизации) и `ac` (количество каналов) могут быть заданы явно или определены автоматически (`"auto"`) – выбираются минимальные значения среди всех склеиваемых файлов.
  - Перекодирование файлов с несовпадающими параметрами во временные WAV, затем склейка через `ffmpeg concat`.
- Вспомогательная функция `resolve_file_list(input_spec, base_dir)` для унифицированного поиска файлов.
- Вспомогательная функция `get_audio_params(file_path)` для получения параметров аудио через ffprobe.

### Изменено
- Шаг `concat` теперь может обрабатывать как видео (с сохранением оригинального поведения), так и аудио.
- Логи шагов дополнены информацией о перекодировании и склейке.

### Исправлено
- Корректная обработка случаев, когда входные файлы для `concat` уже существуют в нужном формате (перекодирование не выполняется лишний раз).

[1.1.0 vs 1.0.0]: https://github.com/jul-den/docker_faster_whisper_json/compare/v1.0.0...v1.1.0


## [1.0.0] - 2026-02-20

[1.0.0]: https://github.com/jul-den/docker_faster_whisper_json/releases/tag/v1.0.0

### Добавлено
- Базовая функциональность: выполнение JSON-задач с шагами:
  - `concat` – склейка видеофайлов (только видео, копированием).
  - `extract_audio` – извлечение аудио из видео в WAV.
  - `segment` – нарезка аудио на сегменты по временным меткам.
  - `transcribe` – транскрибация аудио через Faster Whisper (поддержка масок и объединения результатов).
  - `llm` – отправка текста в LM Studio (или совместимый OpenAI-подобный API) с заданным промптом.
- Ленивая загрузка модели Whisper (модель инициализируется только при первом вызове `transcribe_audio`).
- Пропуск уже выполненных шагов (проверка существования выходного файла).
- Офлайн-режим через переменные окружения `HF_HUB_OFFLINE` и `TRANSFORMERS_OFFLINE`.
- Переопределение параметров в каждом JSON (модель Whisper, модель LLM, URL, токен, удаление WAV).
- Пакетная обработка нескольких JSON-файлов из папки `/source`.
- Логирование с `flush=True` для корректного вывода в Docker-логи.
- Базовая документация в `README_RU.md` и `README.md`.

### Известные ограничения
- Шаг `concat` поддерживает только видео (копирование). Аудио необходимо было обрабатывать отдельно или подготавливать вручную.
- Входные спецификации в `concat` принимались только как строка-маска, без поддержки списков.
- При склейке аудио требовалось предварительное приведение всех файлов к единому формату.
